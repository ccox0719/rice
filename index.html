<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cosmoteer: Card Duel â€“ PnP Test</title>
<style>
  :root{
    --bg:#0f1115;--surface:#171a21;--muted:#9aa7b2;--text:#e8edf2;--accent:#45dfbf;--bad:#ff6b6b;--good:#7bd88f;
    --radius:14px;--gap:12px;--shadow:0 6px 24px rgba(0,0,0,.35)
  }
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial}
  header{padding:16px 20px;background:linear-gradient(180deg,#141823,#10131a)}
  header h1{margin:0;font-size:20px;letter-spacing:.5px}
  main{padding:20px;display:grid;gap:var(--gap);grid-template-columns: 300px 1fr;align-items:start}
  .panel{background:var(--surface);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow)}
  h2{margin:.2rem 0 .6rem;font-size:16px;color:var(--muted);font-weight:600}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .stat{padding:8px 10px;border-radius:10px;background:#10141d;min-width:80px;text-align:center}
  .stat b{display:block;font-size:18px}
  .track{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
  .pill{padding:6px 10px;border-radius:999px;background:#0e131c;color:var(--muted);border:1px solid #1f2a39}
  .controls label{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:8px 10px;border:1px solid #263042;border-radius:10px;background:#121722}
  .controls label span{opacity:.9}
  .controls .cost{color:var(--muted);font-size:12px}
  .controls .sub{margin-left:28px;margin-top:-6px;margin-bottom:6px}
  button{appearance:none;background:var(--accent);border:none;color:#07221b;font-weight:700;padding:10px 14px;border-radius:12px;cursor:pointer}
  button.secondary{background:#222b38;color:var(--text)}
  button:disabled{opacity:.5;cursor:not-allowed}
  .log{height:340px;overflow:auto;padding:10px;background:#0e131b;border-radius:10px;border:1px solid #1f2837}
  .log p{margin:.35rem 0}
  .divider{height:1px;background:#212a39;margin:8px 0}
  .inline{display:inline-block;margin-left:6px}
  .bad{color:var(--bad)} .good{color:var(--good)}
  .footer{opacity:.75;font-size:12px;text-align:center;margin-top:6px}
</style>
</head>
<body>
<header><h1>ğŸš€ Cosmoteer: Card Duel â€” Solo Test vs AI</h1></header>

<main>
  <!-- LEFT: Player controls -->
  <section class="panel">
    <h2>Your Ship â€” Assign for this Round</h2>
    <div class="row">
      <div class="stat"><small>Reactor HP</small><b id="p-reactor">3</b></div>
      <div class="stat"><small>Crew Alive</small><b id="p-crew">3</b></div>
      <div class="stat"><small>Energy (this round)</small><b id="p-energy">3</b></div>
      <div class="stat"><small>Round</small><b id="round">1</b></div>
    </div>

    <div class="divider"></div>

    <div class="row track">
      <span class="pill">Distance: <b id="distance" class="inline">3</b></span>
      <span class="pill">Shields <span id="shieldState">ON</span> until R15</span>
      <span class="pill">Late-game +1 to hit from R16</span>
    </div>

    <div class="divider"></div>

    <div class="controls">
      <label>
        <span>ğŸ›¡ï¸ Shield Generator <span class="cost">cost: 1âš¡ + 1ğŸ‘©â€ğŸš€ â€” blocks on 6 (off after R15)</span></span>
        <input type="checkbox" id="act-shield">
      </label>

      <label>
        <span>ğŸš€ Engine (move Â±2) <span class="cost">cost: 1âš¡ + 1ğŸ‘©â€ğŸš€</span></span>
        <input type="checkbox" id="act-engine">
      </label>
      <div class="sub">
        <label class="row">
          <span style="min-width:80px;">Direction:</span>
          <select id="engine-dir">
            <option value="closer">Closer (-2)</option>
            <option value="farther">Farther (+2)</option>
            <option value="auto" selected>Auto (AI decides)</option>
          </select>
        </label>
      </div>

      <label>
        <span>ğŸ”´ Laser (1 dmg to reactor) â€” Range 1â€“3 â€” hit 4+ (3+ late-game)
          <span class="cost">cost: 1âš¡ + 1ğŸ‘©â€ğŸš€</span></span>
        <input type="checkbox" id="act-laser">
      </label>

      <label>
        <span>ğŸŸ  Cannon (kill 1 crew) â€” Range 1â€“3 â€” hit 4+ (3+ late-game)
          <span class="cost">cost: 2âš¡ + 1ğŸ‘©â€ğŸš€</span></span>
        <input type="checkbox" id="act-cannon">
      </label>

      <label>
        <span>ğŸ’¥ Missile (2 dmg) â€” Range 2â€“6 â€” hit 3+ (2+ late-game) â€” Ammo: <b id="p-missiles">2</b>
          <span class="cost">cost: 2âš¡ + 1ğŸ‘©â€ğŸš€</span></span>
        <input type="checkbox" id="act-missile">
      </label>
    </div>

    <div class="divider"></div>

    <div class="row">
      <button id="btn-resolve">Resolve Round</button>
      <button class="secondary" id="btn-reset">New Game</button>
    </div>
    <p class="footer">Tip: You have 3 energy and 3 crew per round. Each selected system consumes both (as listed).</p>
  </section>

  <!-- RIGHT: Status + Log -->
  <section class="panel">
    <h2>Battle Status</h2>
    <div class="row" style="gap:16px;flex-wrap:wrap">
      <div class="panel" style="flex:1;min-width:240px;background:#121722">
        <h2>ğŸ§‘â€ğŸš€ You</h2>
        <div class="row">
          <div class="stat"><small>Reactor</small><b id="p-reactor2">3</b></div>
          <div class="stat"><small>Crew</small><b id="p-crew2">3</b></div>
          <div class="stat"><small>Missiles</small><b id="p-missiles2">2</b></div>
        </div>
      </div>
      <div class="panel" style="flex:1;min-width:240px;background:#121722">
        <h2>ğŸ¤– AI</h2>
        <div class="row">
          <div class="stat"><small>Reactor</small><b id="e-reactor">3</b></div>
          <div class="stat"><small>Crew</small><b id="e-crew">3</b></div>
          <div class="stat"><small>Missiles</small><b id="e-missiles">2</b></div>
        </div>
      </div>
    </div>

    <div class="divider"></div>

    <h2>Combat Log</h2>
    <div class="log" id="log"></div>
  </section>
</main>

<script>
/* ==========================================================
   Cosmoteer: Card Duel â€” Solo Test vs AI
   Rules baked in:
   - Start distance 3
   - Energy 3 / Crew 3 per round
   - Shields: block on 6, cannot be powered from Round 16+
   - Late game +1 to hit from Round 16
   - Simultaneous resolution (movement then attacks)
   - Victory: reactor<=0 OR crew<=0
========================================================== */

const state = {
  round: 1,
  distance: 3,
  // Player
  p: { reactor: 3, crew: 3, missiles: 2, shieldOn: false },
  // Enemy (AI)
  e: { reactor: 3, crew: 3, missiles: 2, shieldOn: false },
};

const el = sel => document.querySelector(sel);
const logEl = el('#log');

function clamp(val, min, max){ return Math.max(min, Math.min(max, val)); }
function d6(){ return Math.floor(Math.random()*6)+1; }

function resetGame(){
  state.round = 1;
  state.distance = 3;
  state.p = { reactor: 3, crew: 3, missiles: 2, shieldOn: false };
  state.e = { reactor: 3, crew: 3, missiles: 2, shieldOn: false };
  logEl.innerHTML = '';
  write(`ğŸ†• New game started. Distance = 3. Shields active until end of Round 15. Late-game +1 to hit begins Round 16.`);
  render();
}

function write(html){ logEl.insertAdjacentHTML('beforeend', `<p>${html}</p>`); logEl.scrollTop = logEl.scrollHeight; }

function render(){
  el('#round').textContent = state.round;
  el('#distance').textContent = state.distance;
  el('#shieldState').textContent = state.round <= 15 ? 'ON' : 'OFF';

  // Player panel left
  el('#p-reactor').textContent = state.p.reactor;
  el('#p-crew').textContent = state.p.crew;
  el('#p-energy').textContent = 3;
  el('#p-missiles').textContent = state.p.missiles;

  // Status cards
  el('#p-reactor2').textContent = state.p.reactor;
  el('#p-crew2').textContent = state.p.crew;
  el('#p-missiles2').textContent = state.p.missiles;
  el('#e-reactor').textContent = state.e.reactor;
  el('#e-crew').textContent = state.e.crew;
  el('#e-missiles').textContent = state.e.missiles;

  // Disable shield checkbox after R15
  el('#act-shield').disabled = state.round >= 16;

  // Disable resolve if game over
  const over = isOver();
  el('#btn-resolve').disabled = over;
}

function isOver(){
  const pDead = state.p.reactor <= 0 || state.p.crew <= 0;
  const eDead = state.e.reactor <= 0 || state.e.crew <= 0;
  if(pDead && eDead) return true;
  if(pDead || eDead) return true;
  return false;
}

function outcome(){
  const pDead = state.p.reactor <= 0 || state.p.crew <= 0;
  const eDead = state.e.reactor <= 0 || state.e.crew <= 0;
  if(pDead && eDead) return 'draw';
  if(pDead) return 'ai';
  if(eDead) return 'player';
  return null;
}

// Validate player selections vs 3 energy & 3 crew
function validateSelection(sel){
  let energy = 3, crew = 3;
  const needs = {
    shield: sel.shield ? 1 : 0,
    engine: sel.engine ? 1 : 0,
    laser: sel.laser ? 1 : 0,
    cannon: sel.cannon ? 2 : 0,
    missile: sel.missile ? 2 : 0,
  };
  const crewUse = (sel.shield?1:0) + (sel.engine?1:0) + (sel.laser?1:0) + (sel.cannon?1:0) + (sel.missile?1:0);

  if(crewUse > crew) return { ok:false, msg:'You assigned more than 3 crew.' };

  // energy budget
  const totalEnergy = needs.shield + needs.engine + needs.laser + needs.cannon + needs.missile;
  if(totalEnergy > energy) return { ok:false, msg:'You assigned more than 3 energy.' };

  // ammo check
  if(sel.missile && state.p.missiles <= 0) return { ok:false, msg:'No missile ammo remaining.' };

  // range checks (warn, but allow â€” wasted if out of range)
  const d = state.distance;
  if(sel.laser && !(d>=1 && d<=3)) return { ok:true, warn:'Laser out of range (1â€“3). It will waste energy/crew.' };
  if(sel.cannon && !(d>=1 && d<=3)) return { ok:true, warn:'Cannon out of range (1â€“3). It will waste energy/crew.' };
  if(sel.missile && !(d>=2 && d<=6)) return { ok:true, warn:'Missile out of range (2â€“6). It will waste energy/crew.' };

  return { ok:true };
}

// Simple AI selection
function aiChoose(){
  let energy=3, crew=3;
  const d = state.distance;
  const late = state.round >= 16;
  const canShield = state.round <= 15;

  const sel = { shield:false, engine:false, engineDir:'closer', laser:false, cannon:false, missile:false };

  // 1) Shield if allowed and we have spare resources (randomized a bit)
  if(canShield && energy>=1 && crew>=1 && Math.random() < 0.8){
    sel.shield=true; energy--; crew--;
  }

  // 2) Movement: if out of range for all, close; else sometimes kite if player is low reactor/crew (very light logic)
  const inLaser = d>=1 && d<=3;
  const inMiss = d>=2 && d<=6;
  const anyInRange = inLaser || inMiss;
  if(energy>=1 && crew>=1){
    if(!anyInRange){
      sel.engine=true; sel.engineDir='closer'; energy--; crew--;
    } else if(Math.random()<0.25){
      sel.engine=true; sel.engineDir=(Math.random()<0.5?'farther':'closer'); energy--; crew--;
    }
  }

  // 3) Weapons priority: missiles (if ammo & in range) â†’ cannon â†’ laser
  if(state.e.missiles>0 && energy>=2 && crew>=1 && d>=2 && d<=6){
    sel.missile=true; energy-=2; crew--;
  }
  if(energy>=2 && crew>=1 && d>=1 && d<=3){
    sel.cannon=true; energy-=2; crew--;
  }
  if(energy>=1 && crew>=1 && d>=1 && d<=3){
    sel.laser=true; energy-=1; crew--;
  }
  return sel;
}

function resolveRound(){
  // Build player selection from UI
  const ps = {
    shield: el('#act-shield').checked,
    engine: el('#act-engine').checked,
    engineDir: el('#engine-dir').value,
    laser: el('#act-laser').checked,
    cannon: el('#act-cannon').checked,
    missile: el('#act-missile').checked
  };

  // Shield auto-off after R15
  if(state.round >= 16) ps.shield = false;

  const v = validateSelection(ps);
  if(!v.ok){ alert(v.msg); return; }
  if(v.warn) write(`âš ï¸ ${v.warn}`);

  // AI selection
  const es = aiChoose();
  if(state.round >= 16) es.shield = false;

  // MOVEMENT (simultaneous)
  let delta = 0;
  if(ps.engine){
    if(ps.engineDir === 'closer') delta -= 2;
    else if(ps.engineDir === 'farther') delta += 2;
    else { // auto: if no weapon is in range, close; else 25% random reposition
      const d = state.distance;
      const inLaser = d>=1 && d<=3;
      const inMiss = d>=2 && d<=6;
      if(!(inLaser || inMiss)) delta -= 2;
      else if(Math.random()<0.25) delta += (Math.random()<0.5?2:-2);
    }
  }
  if(es.engine) delta += (es.engineDir==='farther'? 2 : -2);

  state.distance = clamp(state.distance + delta, 1, 10);
  write(`ğŸ§­ Movement resolved. Distance is now <b>${state.distance}</b>.`);

  // SHIELDS (active only before round 16)
  state.p.shieldOn = (state.round <= 15 && ps.shield);
  state.e.shieldOn = (state.round <= 15 && es.shield);

  // ATTACKS (simultaneous)
  const late = state.round >= 16;
  const hitBonus = late ? 1 : 0;

  // Helper: roll to hit
  const rollHit = (need) => (d6() + hitBonus) >= need;

  // Per-attack shield block (6+)
  const tryBlock = (defenderShieldOn) => defenderShieldOn && (d6() >= 6);

  const d = state.distance;
  let logRound = [];

  // MISSILES
  if(ps.missile && state.p.missiles>0){
    if(d>=2 && d<=6){
      const hit = rollHit(3); // 3+ (2+ late)
      if(hit){
        const blocked = tryBlock(state.e.shieldOn);
        if(blocked) logRound.push(`Your ğŸ’¥ Missile was <span class="bad">blocked</span>!`);
        else {
          state.e.reactor -= 2;
          logRound.push(`Your ğŸ’¥ Missile hits! <span class="good">-2 Reactor</span> to AI.`);
        }
      } else logRound.push(`Your ğŸ’¥ Missile missed.`);
      state.p.missiles--;
    } else logRound.push(`Your ğŸ’¥ Missile out of range (wasted).`);
  }
  if(es.missile && state.e.missiles>0){
    if(d>=2 && d<=6){
      const hit = rollHit(3);
      if(hit){
        const blocked = tryBlock(state.p.shieldOn);
        if(blocked) logRound.push(`AI's ğŸ’¥ Missile was <span class="good">blocked</span>!`);
        else {
          state.p.reactor -= 2;
          logRound.push(`AI ğŸ’¥ Missile hits! <span class="bad">-2 Reactor</span> to You.`);
        }
      } else logRound.push(`AI ğŸ’¥ Missile missed.`);
      state.e.missiles--;
    } else logRound.push(`AI ğŸ’¥ Missile out of range (wasted).`);
  }

  // CANNONS (kill 1 crew on hit)
  if(ps.cannon){
    if(d>=1 && d<=3){
      const hit = rollHit(4); // 4+ (3+ late)
      if(hit){
        const blocked = tryBlock(state.e.shieldOn);
        if(blocked) logRound.push(`Your ğŸŸ  Cannon was <span class="bad">blocked</span>!`);
        else {
          state.e.crew -= 1;
          logRound.push(`Your ğŸŸ  Cannon hits! AI loses <span class="good">1 crew</span>.`);
        }
      } else logRound.push(`Your ğŸŸ  Cannon missed.`);
    } else logRound.push(`Your ğŸŸ  Cannon out of range (wasted).`);
  }
  if(es.cannon){
    if(d>=1 && d<=3){
      const hit = rollHit(4);
      if(hit){
        const blocked = tryBlock(state.p.shieldOn);
        if(blocked) logRound.push(`AI's ğŸŸ  Cannon was <span class="good">blocked</span>!`);
        else {
          state.p.crew -= 1;
          logRound.push(`AI ğŸŸ  Cannon hits! You lose <span class="bad">1 crew</span>.`);
        }
      } else logRound.push(`AI ğŸŸ  Cannon missed.`);
    } else logRound.push(`AI ğŸŸ  Cannon out of range (wasted).`);
  }

  // LASERS (1 dmg to reactor)
  if(ps.laser){
    if(d>=1 && d<=3){
      const hit = rollHit(4); // 4+ (3+ late)
      if(hit){
        const blocked = tryBlock(state.e.shieldOn);
        if(blocked) logRound.push(`Your ğŸ”´ Laser was <span class="bad">blocked</span>!`);
        else {
          state.e.reactor -= 1;
          logRound.push(`Your ğŸ”´ Laser hits! <span class="good">-1 Reactor</span> to AI.`);
        }
      } else logRound.push(`Your ğŸ”´ Laser missed.`);
    } else logRound.push(`Your ğŸ”´ Laser out of range (wasted).`);
  }
  if(es.laser){
    if(d>=1 && d<=3){
      const hit = rollHit(4);
      if(hit){
        const blocked = tryBlock(state.p.shieldOn);
        if(blocked) logRound.push(`AI's ğŸ”´ Laser was <span class="good">blocked</span>!`);
        else {
          state.p.reactor -= 1;
          logRound.push(`AI ğŸ”´ Laser hits! <span class="bad">-1 Reactor</span> to You.`);
        }
      } else logRound.push(`AI ğŸ”´ Laser missed.`);
    } else logRound.push(`AI ğŸ”´ Laser out of range (wasted).`);
  }

  // Clamp stats
  state.p.reactor = Math.max(0, state.p.reactor);
  state.e.reactor = Math.max(0, state.e.reactor);
  state.p.crew = Math.max(0, state.p.crew);
  state.e.crew = Math.max(0, state.e.crew);

  // Write round summary
  write(`<b>â€” Round ${state.round} â€”</b>`);
  logRound.forEach(x => write(x));
  write(`You: Reactor ${state.p.reactor}, Crew ${state.p.crew}, Missiles ${state.p.missiles} &nbsp; | &nbsp; AI: Reactor ${state.e.reactor}, Crew ${state.e.crew}, Missiles ${state.e.missiles}`);
  write(`<span class="muted">Shields: You ${state.p.shieldOn?'ON':'OFF'} â€¢ AI ${state.e.shieldOn?'ON':'OFF'}</span><br>`);

  // Check victory
  const out = outcome();
  if(out){
    if(out==='player') write(`<b class="good">âœ… You win!</b>`);
    else if(out==='ai') write(`<b class="bad">âŒ You were defeated.</b>`);
    else write(`<b>âš–ï¸ Draw â€” both ships disabled.</b>`);
  } else {
    state.round++;
  }

  // Clear checkboxes for next round
  ['#act-shield','#act-engine','#act-laser','#act-cannon','#act-missile'].forEach(id=>{ el(id).checked=false; });
  render();
}

// Hook up UI
el('#btn-resolve').addEventListener('click', resolveRound);
el('#btn-reset').addEventListener('click', resetGame);

// Kickoff
resetGame();
</script>
</body>
</html>